<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titanic Survival Rate EDA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-bar {
            transition: height 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 p-8 flex justify-center items-center min-h-screen">
    <div id="main-content" class="bg-white rounded-xl shadow-2xl p-8 max-w-7xl w-full">
        <h1 class="text-4xl font-bold text-gray-800 text-center mb-2">Titanic Survival Rate Analysis</h1>
        <p class="text-gray-500 text-center mb-8">An exploratory data analysis of survival rates by key passenger attributes.</p>
        
        <div id="loading" class="text-center text-gray-500 my-10">
            <svg class="animate-spin h-8 w-8 text-blue-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-2">Loading and analyzing data...</p>
        </div>

        <div id="charts-container" class="hidden grid grid-cols-1 md:grid-cols-3 gap-8">
            <div id="sex-chart" class="bg-gray-50 p-6 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Survival by Sex</h2>
                <div class="flex items-end h-48 gap-4" id="sex-chart-container"></div>
                <div class="mt-4 text-sm text-gray-600">
                    <p>Female: <span id="female-rate" class="font-bold"></span>% survived</p>
                    <p>Male: <span id="male-rate" class="font-bold"></span>% survived</p>
                </div>
            </div>

            <div id="pclass-chart" class="bg-gray-50 p-6 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Survival by Passenger Class</h2>
                <div class="flex items-end h-48 gap-4" id="pclass-chart-container"></div>
                <div class="mt-4 text-sm text-gray-600">
                    <p>1st Class: <span id="pclass1-rate" class="font-bold"></span>% survived</p>
                    <p>2nd Class: <span id="pclass2-rate" class="font-bold"></span>% survived</p>
                    <p>3rd Class: <span id="pclass3-rate" class="font-bold"></span>% survived</p>
                </div>
            </div>

            <div id="age-chart" class="bg-gray-50 p-6 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Survival by Age Group</h2>
                <div class="flex items-end h-48 gap-4" id="age-chart-container"></div>
                <div class="mt-4 text-sm text-gray-600">
                    <p>Children: <span id="age-child-rate" class="font-bold"></span>% survived</p>
                    <p>Teens: <span id="age-teen-rate" class="font-bold"></span>% survived</p>
                    <p>Adults: <span id="age-adult-rate" class="font-bold"></span>% survived</p>
                    <p>Seniors: <span id="age-senior-rate" class="font-bold"></span>% survived</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const mainContent = document.getElementById('main-content');
            const loadingIndicator = document.getElementById('loading');
            const chartsContainer = document.getElementById('charts-container');

            if (typeof __files__ === 'undefined' || !__files__['train.csv']) {
                loadingIndicator.classList.add('hidden');
                mainContent.innerHTML = "<p class='text-red-500 text-center'>The 'train.csv' file was not found.</p>";
                console.error("The 'train.csv' file was not found.");
                return;
            }

            const csvContent = __files__['train.csv'].content;
            console.log("File content loaded successfully.");

            // Manual CSV parsing function to handle quoted commas
            const parseCSV = (csv) => {
                const lines = csv.trim().split('\n');
                const headers = lines[0].split(',').map(header => header.trim().replace(/"/g, ''));
                const data = [];
                for (let i = 1; i < lines.length; i++) {
                    const row = lines[i];
                    if (!row.trim()) continue;
                    const values = row.match(/(?:\"(?:[^"\\]|\\.)*\"|[^,"]*)+/g).map(v => v.replace(/^"|"$/g, '').trim());
                    const entry = {};
                    headers.forEach((header, index) => {
                        entry[header] = values[index];
                    });
                    data.push(entry);
                }
                return data;
            };

            const data = parseCSV(csvContent);
            console.log(`Parsed ${data.length} entries.`);

            // Perform EDA analysis
            const survivalRates = {
                sex: {},
                pclass: {},
                age: {}
            };
            const counts = {
                sex: { male: { total: 0, survived: 0 }, female: { total: 0, survived: 0 } },
                pclass: { '1': { total: 0, survived: 0 }, '2': { total: 0, survived: 0 }, '3': { total: 0, survived: 0 } },
                age: { child: { total: 0, survived: 0 }, teen: { total: 0, survived: 0 }, adult: { total: 0, survived: 0 }, senior: { total: 0, survived: 0 } }
            };

            data.forEach(passenger => {
                const survived = passenger.Survived === '1';

                // By Sex
                if (counts.sex[passenger.Sex]) {
                    counts.sex[passenger.Sex].total++;
                    if (survived) counts.sex[passenger.Sex].survived++;
                }

                // By Pclass
                if (counts.pclass[passenger.Pclass]) {
                    counts.pclass[passenger.Pclass].total++;
                    if (survived) counts.pclass[passenger.Pclass].survived++;
                }

                // By Age Group
                const age = parseFloat(passenger.Age);
                if (!isNaN(age)) {
                    let ageGroup = 'adult';
                    if (age <= 12) {
                        ageGroup = 'child';
                    } else if (age <= 19) {
                        ageGroup = 'teen';
                    } else if (age >= 60) {
                        ageGroup = 'senior';
                    }
                    if (counts.age[ageGroup]) {
                        counts.age[ageGroup].total++;
                        if (survived) counts.age[ageGroup].survived++;
                    }
                }
            });

            // Calculate percentages
            for (const key in counts.sex) {
                survivalRates.sex[key] = (counts.sex[key].survived / counts.sex[key].total) * 100;
            }
            for (const key in counts.pclass) {
                survivalRates.pclass[key] = (counts.pclass[key].survived / counts.pclass[key].total) * 100;
            }
            for (const key in counts.age) {
                survivalRates.age[key] = (counts.age[key].survived / counts.age[key].total) * 100;
            }

            // Render the charts
            const renderChart = (data, containerId, labels) => {
                const container = document.getElementById(containerId);
                container.innerHTML = ''; // Clear previous content
                const keys = Object.keys(data);
                
                keys.forEach((key, index) => {
                    const percentage = isNaN(data[key]) ? 0 : data[key];
                    const barHeight = percentage === 0 ? 'h-0' : `h-[${percentage}%]`;
                    const color = percentage > 50 ? 'bg-green-500' : 'bg-red-500';
                    
                    const bar = document.createElement('div');
                    bar.className = `flex-1 flex flex-col items-center justify-end text-white relative chart-bar ${color} rounded-t-lg shadow-md`;
                    bar.style.height = `${percentage}%`;
                    bar.innerHTML = `<span class="absolute -top-6 text-sm font-semibold text-gray-700">${percentage.toFixed(1)}%</span>`;

                    const label = document.createElement('div');
                    label.className = "text-center mt-2 text-sm text-gray-600";
                    label.textContent = labels[key];

                    const barWrapper = document.createElement('div');
                    barWrapper.className = "flex flex-col items-center flex-1";
                    barWrapper.appendChild(bar);
                    barWrapper.appendChild(label);
                    
                    container.appendChild(barWrapper);
                });
            };

            // Render each chart
            renderChart(survivalRates.sex, 'sex-chart-container', { male: 'Male', female: 'Female' });
            document.getElementById('female-rate').textContent = survivalRates.sex.female.toFixed(1);
            document.getElementById('male-rate').textContent = survivalRates.sex.male.toFixed(1);

            renderChart(survivalRates.pclass, 'pclass-chart-container', { '1': '1st', '2': '2nd', '3': '3rd' });
            document.getElementById('pclass1-rate').textContent = survivalRates.pclass['1'].toFixed(1);
            document.getElementById('pclass2-rate').textContent = survivalRates.pclass['2'].toFixed(1);
            document.getElementById('pclass3-rate').textContent = survivalRates.pclass['3'].toFixed(1);

            renderChart(survivalRates.age, 'age-chart-container', { child: 'Children', teen: 'Teens', adult: 'Adults', senior: 'Seniors' });
            document.getElementById('age-child-rate').textContent = survivalRates.age.child.toFixed(1);
            document.getElementById('age-teen-rate').textContent = survivalRates.age.teen.toFixed(1);
            document.getElementById('age-adult-rate').textContent = survivalRates.age.adult.toFixed(1);
            document.getElementById('age-senior-rate').textContent = survivalRates.age.senior.toFixed(1);

            loadingIndicator.classList.add('hidden');
            chartsContainer.classList.remove('hidden');
        });
    </script>
</body>
</html>
